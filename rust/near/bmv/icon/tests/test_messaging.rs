use bmv_icon::BtpMessageVerifier;
use hex::{decode, encode};
use libraries::{rlp, types::messages, types::BTPAddress, MerklePatriciaTree};
use near_sdk::{testing_env, PromiseOrValue, VMContext};
pub mod accounts;
use accounts::*;
use near_sdk::env;
use near_sdk::json_types::U64;
use near_sdk::AccountId;
use std::convert::TryFrom;
use std::ops::Deref;
use libraries::types::Hash;
use near_sdk::borsh::BorshSerialize;

#[cfg(feature = "testable")]
use bmv_icon::types::{RelayMessage, Sha256, Validators};

fn get_context(
    input: Vec<u8>,
    is_view: bool,
    signer_account_id: AccountId,
    storage_usage: u64,
    prepaid_gas: u64,
) -> VMContext {
    VMContext {
        current_account_id: alice().to_string(),
        signer_account_id: signer_account_id.to_string(),
        signer_account_pk: vec![0, 1, 2],
        predecessor_account_id: signer_account_id.to_string(),
        input,
        block_index: 0,
        block_timestamp: 0,
        account_balance: 0,
        account_locked_balance: 0,
        storage_usage,
        attached_deposit: 0,
        prepaid_gas,
        random_seed: vec![0, 1, 2],
        is_view,
        output_data_receivers: vec![],
        epoch_height: 19,
    }
}

#[test]
#[cfg(feature = "testable")]
fn handle_relay_message() {
    let context =
        |v: AccountId, gas: u64| (get_context(vec![], false, v, env::storage_usage(), gas));
    testing_env!(context(alice(), 999_999_999_999_999_999_9));

    let mut contract = BtpMessageVerifier::new(
        alice(),
        "0x2.icon".to_string(),
        Validators::try_from("0xf901fa9500e45ef7de9eef0200a4090e57d6b92f40377eaea19500e21a90699ce258a01b8b4b5b00984163bff7affc9500cddf5733929ee06b98eef590157ac06db609ff239500cd83400d8c2331b28ea6a41e28efcb90fea2308d9500c513e4772b9e7a8cebf0479ef984bb2fed79738e9500b302f1147dab852e5b55b6b35ea79f810838f59195007d988272c3eb62500843fb64fc9feccbc604c55a950079e692813dfb510b8184dc132986974f20cbad37950073dbec60e200a741d607b4e1233ca347a7d05df695006f36c0b3c0a2ee1bd33a888f84b6dedc79f7052a9500671e16197d321ca12e5a560f48aa1a1b925faf1b950065fce9c0040489cf28d221f92e61a8687cf2bf2d9500657997be01c2c722776aa86aeb1faab99b17367d95004d4acd34c79a6b3cee9be4a49989f0e37f6c5c3195004bae569c98bf2fe69ec71e2e9d1b5189fdd47cf995004417d5d6a6aff9b7379a54332bcc0492c8f211e7950040abb59013b011c98d880314db92d762fab3ee1595003fb286b352c35d229113bb72fdd7b65da4826ad0950024158e77bae2b3e90b9ae554e5da28f5629b0f8b95001f7578266186c6e7b6b4be0ccd5d3a3829e98d939500193548d3b36f41faddac75fc3491eb4701182927950010f6b0079c455d5b766e02e460996e1872f45f549500eb974e03a77214eb3ca4acb9a28f7edb17113513".to_string())
        .unwrap(),
        U64(7420493),
        Hash::try_from("0x2a825ff6e97ffc59ebdc170a315aa10c7bd21afe3b0482ab0c676116871d6ff5".to_string()).unwrap()
    );
    let relay_message = RelayMessage::try_from("-Sf8-Sf2uQam-QajuQGh-QGeAoNxOk6HBd8fZuNo7pUAxRPkdyueeozr8Eee-YS7L-15c46gwx77-XRLdQfKDXWXja8loR76gBGtUzKaox5t1tcf1oegcx15ekc4G5ZafmopNdT2Oe2iJlbM6uw0QhXVTP8VfMmgb8gtsHiOYT-ag4keuRIfZHEQmZ2wE29ryodd5WGRiIP4AKDjZb-3vDjBn5U_FBDyP3SsfHCLPdeOeYOkq0zQOKakYKIBACBwSCwaDwMEQQAwiGw6HxAAQqIwaJxSLxiMwcgRqBwEuND4zqBDTJ_TJEYuBWhrrSWnBEeRVB0DYZg4hCe1PD3YCY6eyPgAoJrgmrpQx0eJrNIRQ8RT2nFVjslocIPOOZdVqYnvfwaquIj4hqBhPrhL16DVq_SXbGxboe_i4Qc2xVcJeNIx124rKHsi8KBXOaJl5cMZ_Vdt1Beao-nOaYlglSPT5AZgru_DUa77JvgAoJ5W0f-IeMhYNwmSV_xtcKN1sOMaSMhkeB5xSRL262xEoBmpAuCT9p2CHMJHmEGj34_hrFuV7undmK1PiB-caAHyuQT6-QT3AOIBoFmO-8Y-feJ6UIO5wvwOD8kCpp0f2blGq3cqZNMBb0ph-QTQ-EuHBd8fZwNUKLhBY0mrJ6oongI-xGzN5cYSoXhLB4kSmtekKkiN9854VItDdzje7qdPSzOt2thOeubKUWWbFpFiy8TYES1YJfP5mAD4S4cF3x9nA02nuEGU4ED4kM7Oylg1vjys5fyPg52qP4t87EMUpmj7NnZ52SzQs_DBirSt3ndrmHnnAp45ooPPV6J82TNC4S3JjJCTAfhLhwXfH2cDYou4QTW5MdXOhHxFWd-L0KwuAL4r67EyykAZWpvbl3Z_IsVPVEeBKqqoA4RMysFJiVmvPBcaVZkgpQhhM0dwMVlRm-kA-EuHBd8fZwJR37hB-JRZ3yXCu796KR1IbP1enTsptXhDvGHb4iCqKwtg3ewpdizvI5kLxz388Mo8PqiYwfCxYLiPbmGQa_36hjKyuwH4S4cF3x9nAlQBuEFgfufu5toMk8m5VNXnIjPPBEJ5n_YG5IpNI7p-ujtPbFCYuTsOxfiMEQToVzO6BMq_BDOPscVr57aKKEHk07uxAfhLhwXfH2cDWjW4QXaNTM7IUM1L45jaUhURqNuZfdMigmh1dfUa3w6W0oMbFg77Py9aez3ByxzeyEW8qqRfsOmeXmn_MRF6x1ENBWoA-EuHBd8fZwJTb7hBHitoxeosMScxAfFVhxEP8ZK72U1cKd3mCZpFUG8BqcdU-rIt3pxxNp3F3AtLklCadoaGN4LU5fzlfxdsL2wsRgD4S4cF3x9nA0w0uEEXOBKX-dOtfKv6YsxY24fCalQQdQK5af0G-Pd3gzAEHlLnR0LOfBC0XtS4jU64-AWv57AaphiTEGeJNxWceVRaAfhLhwXfH2cDQpW4QfSKt7YcblF_CN3_fUEvjqk6ZBUS1mYyeRj_m4zK90vpCbbVwCQACFQ1obk2t5K7w6V58pzRIWhV4Rc24Rh_I14B-EuHBd8fZwNJdbhBp7plYFROJhcJpu2MCpS8qiTQ9OL6EkV1lkO0z12nSWgNZgV7CyYCHjj4MbLkPOjDqSaI5hwEJagDDq2RU6unuAH4S4cF3x9nAlK2uEEu2C0TYrNND65H5sCjo1Vybr1g-tfwgbFPsJK0nNdUgVOZ1pXIcvhaMXylTAfrqBfZuDstl6s78k0SyZEGad_YAfhLhwXfH2cCTeS4QZ8vHnO0dE11yBn-POSIeHTHEIft3MOIXJQ9oIU2a3YBHs0tugD5sqt8n4GlxPjmZtyizPUJx5w-JS_gubXtozcB-EuHBd8fZwJWb7hBDvuKaqcFLy5ZTQmN2hOdPjOPfWfyzvvKHa-38deyWBUTVe5TuRjt_jNdA5SHFe3HFOhR_ZWTyihDUlQQseVSlwH4S4cF3x9nAlHjuEGmAniquzrTQe8kipoWXW6F7tLnBOKQiPNskVUc3xzrfAcEbcRAvVCAtlJ-EyIU4Z9ezD44RR0bTb35c8hb1-1BAfhLhwXfH2cDVNe4QcHB2oDdKg2b8lty6mKZ7J93csit3DvJpE6GSyYnB8EkClfORJf20DaoPBRcVROaw7HgX8z4AyrvY1HfHcFE_xAA-EuHBd8fZwJUGLhB4V_it5EZcAfaFSuXhqh4C6_Eg2FiHRvipW6xy6KuCUU3AXRV2p_386XMiC9EC8H2wi6p9e1kRqBD-Cu6YaHeEQH4ALkGpvkGo7kBofkBngKDcTpPhwXfH2cDTO2VALMC8RR9q4UuW1W2s16nn4EIOPWRoPf9YCwima23Qz0pIEHqMC_fz5O5kgjnhtWaP5sL23g7oCD5YoDIBDVrNdjRJOtg97aBni9zKI78rwsXKXrY9ptMoG_ILbB4jmE_moOJHrkSH2RxEJmdsBNva8qHXeVhkYiD-ACgGyAHZD2rYQjzsinUbN26URPRP2KNJGSMrSpwa4mfJ1eiAQAgcEgsGg8DBEEAMIhsOh8QAEKiMGicUi8YjMHIEagcBLjQ-M6gEPodCplfq5kr3sv7NyZ_ZcFnbrUJq6hyJ7GGUf0DSrz4AKCa4Jq6UMdHiazSEUPEU9pxVY7JaHCDzjmXVamJ738GqriI-Iagrs-YWhCo2VegS86u3_7KYGIGmY6TnHGonP-VGRWYMJ2gVzmiZeXDGf1XbdQXmqPpzmmJYJUj0-QGYK7vw1Gu-yb4AKCeVtH_iHjIWDcJklf8bXCjdbDjGkjIZHgecUkS9utsRKAZqQLgk_adghzCR5hBo9-P4axble7p3ZitT4gfnGgB8rkE-vkE9wDiAqBo4Y9W_3RdDl19uwPcMacocaOVWCrVsilZq6Acj_2PnvkE0PhLhwXfH2ci3W-4Qe30EWYh85a9_97v1aNX5Ld4e3Ijj0JVIEShbBHZZi-WOU4nAQnHM4vbMUs7vATu-ssk4D4XQHxkFgnc1BZpWk4A-EuHBd8fZyMCqLhBfpqf23nxNpEG5CHUmdMc1rG9hbL2ujzQeIU0tYht0MlcNDpH-Hp6inLqiuW2U4TPZ_3CnyUarKI9_linNQEj6AD4S4cF3x9nItxNuEFQuBZsnTLe-s1JjU8jVOxztKZML7nJNxSDrJONEj6UCGnfnklV7PVDc9D9z68N5nWs5ZXEsiNvYoKOWW7WEy3NAPhLhwXfH2ckJla4QbtSEGGFCcQ7ckDdy0TYmoa8t39uD-lDTVBZ61i_ZMc6DtsTyt1YLHW--lb9bHHRn5L1keMXuGGG2oxMT7HQ5dQA-EuHBd8fZyPzgbhBXYMtRChpynf_UJYxEucNHdtc7DGbSaj9eEV0KHOhVbpdWaZdIhpBMypMcB2Ecf7cgTBuC8RV7MGnizM6si2jQgH4S4cF3x9nIuTVuEG8tVEyCtnZ90O04Kw0j9ZIDahEFoGsFPF4cr30jNGDCFyt0CtEAZKuXpfjn4hNti-pIJATnsQm2BSQQWHFADxCAfhLhwXfH2ckJs24QW-8_xU6vbLplUx8XFUMmepTEU0Q6oaK4VPvnjnMTgu5VrBgRyqeyHi_afC5LYLXJ0e_Jio8j2zw0_ZJ8e5rJDoA-EuHBd8fZyLhhbhBrrMvRRrknIO_XvXzcKgtTx1HYjBopBlHVEqoPVHYCf0TQRe0_mQhmqjunnVkq3CLzOeL4o3m1ns-cduqnSh_ygD4S4cF3x9nIvePuEE0VNHJHfHKsQLSy0qOeqEaThqeG6y_ELJPCDyDNv4dlittI98CfQdhfT55af_XZEi_gIrPAhyQklPJgkMPMK3XAPhLhwXfH2ci9a-4QeknUob3fYISwaKl86SWJeB_XNhytgoy6SLdFXU5Bi1BGEmqH1WQDe5eY1iggJd5iuOeTzTVnPi-GQpMGnKepTgA-EuHBd8fZyQO_bhBhbmTbllzsRfirD5qvyYr5Cg9E9vqQSGj5IiiW1yyZJdXjiLf012OGCpTxMYfM3_49jNSO5YxYmkBD6ZUHHlP0AD4S4cF3x9nJA71uEGjY5Lz4ROb3JHZYBhwHlYuI4cr0eAXYfVEJfo4H_8sZA0OXPlCHnvBDLEglm7Ch8ae7xSmji-HUI0wQ49eswFeAPhLhwXfH2ckCpu4QW6AioW3uYZHXZGoY0d8iTy4mzkA-nFlB2vlkrHid8psH4UQVuNss7VG2Du-wl5c3XmP664cZG-pmn5GZbjxCw4B-EuHBd8fZyLzy7hB8LemBFZs7aRLRHZiyTDSs8Ui2l2WqT58Uw1rnwmXYHQ_ptUacwxokI908RUZKqyCg_9a-Ycpxs9xFoeeXbbUzAH4S4cF3x9nJIlJuEFJV49uRTEck7cW13fyIroFzj60aCErTTlPhv5tFksSkULJX7Y1OtlcsFQ-AENKajwte7vWkSG0fkml50Ec0-hcAfhLhwXfH2ckHli4QTrsEP6XUNk9P76jv-gKjBNkk-xk3WVHErM3nniyofhoHdUrZytu7oiqY5q6K7ZwHHAen4SZrbe1a1ZtK926FjkB-AC5Bqb5BqO5AaH5AZ4Cg3E6UIcF3x9nI3sUlQB9mIJyw-tiUAhD-2T8n-zLxgTFWqDxNpfH8bXXno1bqq4LwhZ1rxzSZqcNwmA6Ps24V9EhcaB2S-JWeTpA0Iao-i9QwpUQT0jmZ5pliYJbzrzRWTPKxaBvyC2weI5hP5qDiR65Eh9kcRCZnbATb2vKh13lYZGIg_gAoFDhTpnoA18-S5E_yfiX2HWX4RmgH6UeTCqySzxBToIUogEAIHBILBoPAwRBADCIbDofEABCojBonFIvGIzByBGoHAS40PjOoOnPHd10hykOr5g4oga7o9PTG6OQaIanczejNvJCUZxv-ACgwCgJ2srxX3gw-nZVURlwOQaDz5GNza1lTjdrsdzsfFi4iPiGoLL92xuw8lXEecY4Z8u9PY3Ko6L5OyihL-QzwkOt2CJzoFc5omXlwxn9V23UF5qj6c5piWCVI9PkBmCu78NRrvsm-ACgnlbR_4h4yFg3CZJX_G1wo3Ww4xpIyGR4HnFJEvbrbESgGakC4JP2nYIcwkeYQaPfj-GsW5Xu6d2YrU-IH5xoAfK5BPr5BPcA4gGgbF74aijtUepzuwmZXy9Vt6XWkulXqjH2q3CYqRMsgIj5BND4S4cF3x9nPxAVuEHhhex7k5Hj3sK4yWIFeSp3a-1gsANQ0HwWlCSNPnVn8SWG22YRUgNrJYTieplaZse2-RJhnZgMOP9hjPmAVr1EAPhLhwXfH2c_BYO4QWmruGFIJUyO1w2jNCChF31VgIcOQHp1vcmqD0uVjz22TWxZBzof24wkeStTQRrJ3kf6Wms0fyyHLr0N8MT0AWkB-EuHBd8fZz8JoLhBUVlvi0n4ciU9nm0cIkgqcaR_WLYwcdAZXNoGf4U_5YMBqc7EzXuwhj8mkFeaZ4cdxgKZpdkuDyjSMPrH0dwtOwH4S4cF3x9nPkwFuEFCFFWnCA0d-AW_5tDrx-vQES7DItVhsEha9TVIHxiUrxrjuunVZoKchr82BqYtrAWBKcXpLUxuG_vtO8ghK5MeAPhLhwXfH2c-Snm4QchqDnPr2hIXyYaDPA9CWY12VFKVkwMaRhFxDD_LCfCwXSWMywz81SI8DtW0xUzbDTYYTT24Mjg2Fjbq_B4_iN8B-EuHBd8fZz8QErhBS4kl4mP05VNMYUE015KIgg95H9zoo6BNrID6vEv2HW9nhu7bLXRUzHc3RnQmJvHLqbWoVgJ0HUCxYAAt1N144wH4S4cF3x9nPkb6uEFHhS52XcnAu098TJKYjr7IKOCenkvzr7WFYUBEE3aYThfCFgtYENCgXhZ7zjevPHQdXD2WoEEUVPkJVp56DXq0APhLhwXfH2c_K4u4QWyZLGyrap1GYzBMEg3-ctz6C-fPVoQAfqOTqATKhvvDCjJzN26PI6hgenzMlJx3YApk1eB1EviM_7SgDwL9iqUB-EuHBd8fZz8RQ7hBZeic2xwozX3tjQ9UU2v2hTh-y_kkQosCvnmre81_C2wcoXEZrJOVYqNGgp-teWPQiLLOy3i25kxUTt65lRHPtQH4S4cF3x9nPw3AuEGQIZmN5vV5Si0M6k6ZedfL4_b-P3ktjGP3W6B0Hri_dRDzCm5wW_EDINreKlsoiguvJFH2sz4QJW10NB2nObQwAfhLhwXfH2c-Snq4QfBSD_-qesIbcmaABk6gUHnFTg_gSlFDj87EJ1KJyVA1Hjd5gWmRPtNCVTLPGLcnQmeRXWJ4N9dLhcPUUGGUkyAB-EuHBd8fZz5G5rhBVnuovuOQfRA75QVDh2aAq0_q20teKsav49ThIs2lhRxNsYcPTW0rsUkmXWmdnoW977bPKRYVhAAtLUiocDJlTgD4S4cF3x9nPlKEuEFs3B9ZU2cAGm3co1rQDDUI72e7hCKxLEqWj7wifb5y72v7GpCIUvr9sUk1NUX5t0_eIxJAEbeSh67YvclLZYYjAfhLhwXfH2c-TCK4QfDXb8niZyJqToJ0FE7XsNCfqiO6fcQkEk9KXMQlzLcYVB_TE7nEJGLUX4APJ24STW7IR_RNLlBeJAX5UITBFAcA-EuHBd8fZz8GAbhBoJCLoCqllYPL_ClFOHIPKwsJtqVGoEwJPNoH02mlAT0uoqwkGw1e6csaJSe0_GVkPKVeTQdEfcKUZ8Gl5RB9egH4S4cF3x9nPkqNuEF8WgRhGbGzIDOAnTvihOa58r2hr32VfqzG7ck1pwmQvRhXzjUqdNgSBNXJyzBjcqSyviTHKlUtT-RCcTcjoagvAfgAuQam-QajuQGh-QGeAoNxOlGHBd8fZz8LsJUAeeaSgT37UQuBhNwTKYaXTyDLrTeger2oX1h7a1ZvEe5lb30lo3q5rfTMPxRgh6bfrWGFzwiggB2u0luDe-HDsezvNk9zsVJlRhGjFYEmI5sxwwCv032gb8gtsHiOYT-ag4keuRIfZHEQmZ2wE29ryodd5WGRiIP4AKBLogw5UXFpL-MKptVzPwjQKOAe8dpbj4889Jur76QpwKIBACBwSCwaDwMEQQAwiGw6HxAAQqIwaJxSLxiMwcgRqBwEuND4zqDpzx3ddIcpDq-YOKIGu6PT0xujkGiGp3M3ozbyQlGcb_gAoJMpjBfxy3xaF7AIkvre0IY7K3p5580p12bg8xL6rkT6uIj4hqC2ZZANTRhvSGSa5qmAN2iH5wrhpwwjhIgleBJ-GWmSm6BXOaJl5cMZ_Vdt1Beao-nOaYlglSPT5AZgru_DUa77JvgAoJ5W0f-IeMhYNwmSV_xtcKN1sOMaSMhkeB5xSRL262xEoBmpAuCT9p2CHMJHmEGj34_hrFuV7undmK1PiB-caAHyuQT6-QT3AOIBoGYP-kkSZ7mK0V26n2ooBfM9tx6iyd-T6eZDVIC8L5ZM-QTQ-EuHBd8fZ11ULrhBqdzCAbR2k0HcgHeCnQdf51IDK7PWn5RneF2DxhfWloAxL54OJeiOK2ENqVEBGJeuy3LWWEv8-AYJ1uAhVHnuTAD4S4cF3x9nXVnWuEHzhnG9DLR2Tag6Ap-mDxybL0ft1I2hP5fQQhLygNtia1KLsWP3ng73mNRcZ-Y_vyAUy5Oh734YQu7Y4ZgsGwrmAPhLhwXfH2dddn-4QUSsllNyCXa90HZA72ED9_8LLtCf2tWyFI3sE7vhxHdbLiocCb-mkMpf-U-HY-OWF2BIxE0HVPYszifRx2Z5jGMB-EuHBd8fZ13nobhBfacYbX26PBTE2qH4bDuN8OxgmivtQA52OfbHG0D13c9bB6hV4-y6CtItebHTQxuBr5weAyC2ffnN6fu01lhOMQD4S4cF3x9nXenHuEGGrPEoVm4VSHvwZzvR1LuyrFnzCSwarqTA7Fs0l9FKG1Q2I2hsNdeyybBs0l5ysBjew7X6VT5soOcYnRYA8x_OAPhLhwXfH2ddV2S4QYZsf_vgrFz_AC9-GbI7W8fsOHZqCoQZ-vKJ1ruX8vshUghi5F_2_vPhj-K9d7HTEmUuEycngonFvp8JA4ragLkB-EuHBd8fZ13m5rhBxhVPIT53xWj2D3_lV3Pp6zlUdcR-LP6FxK5U3kKFGOxCynItgkhwKI4KmiAM9nGfzt_TSUW1k3-Lk0BaEtsYWAD4S4cF3x9nXVaNuEHQPvo3dyjpNdXJWlsMYvosfmjn9Y5qYf0WlM9JfKXU5SDXBO-t_k8wi7OmBxCm9gOHEZGMjg03Yw-UrNPaD_1LAfhLhwXfH2ddR5q4Qdqxjcw3TJKtopGM77f4VYwGM3taUzHSroGussA42ETgatSU4aUeeZjQRQvhua6MGR8j5y5H-ZhmDeadY0AIUlgA-EuHBd8fZ11okrhBxQPUHCiXArOmKChpKumSSGnv4nEzxGwF02GaleqflsZjlgWxBkChmP7d7gFYX5BndgaJT8-jLdf6G6C_9iL0CgD4S4cF3x9nXeVhuEH6dNKikCcO6FSRm4QKnvaedIKgda6W10Cgg1Cj5j4YBCbW5NhYtfdmvT8imfBXMIvI2rGgMBOzhhtMYummrRfXAfhLhwXfH2dd5H24QQJXnZEbcB43qTRFzQNEaREP6rZSZflofYETGfQdOmSqV_5PohwTjL7B0zUoZ8Ob_A0ePffhW_ewU--huBHPU3MA-EuHBd8fZ13r2rhBlBbkDq5dA2z3FOlBA1Ow0OQu2dn2vaCRxSyYZobvkXstPCXljYa2X-1WZl9otrqagTLNQbjXYL-sN5bje9XMxQH4S4cF3x9nXe-4uEHoF12hZ7cSdLEFlMb_bL36p2ffAH6gvhfalVq49sNPhRBONtx0q-W6N2x-OQ6JigNXbNuoR_ZpCSu3eji-4K97APhLhwXfH2ddbyO4Qc58CUFGpj3GzC9p09UCdSg8NGYvJSdxf8fsxm2YNxV0SPypAsuvQm3VyZE4zTXVmMT1GJE3q3-IbiTSh-XEWpcA-EuHBd8fZ13nDrhBq03IHpbsNy3Fi5VQb7lOZO_G3KbjAcUnsuPCFm7MmadssfwVMQ2UR9Yjqo7ef2IcBdBTd4Uhvu7jlUhnrVHBggH4ALkGpvkGo7kBofkBngKDcTpShwXfH2ddf86VAHPb7GDiAKdB1ge04SM8o0en0F32oEE66SSi2KITfY0x3RgpbzVFQkyF9L2ff9QsouX-x62toDct1Oc9PgdLw_7GhPqgyr0fUpxR7pSj4I2dE-_TB1dyoG_ILbB4jmE_moOJHrkSH2RxEJmdsBNva8qHXeVhkYiD-ACgFRE9HgVlLgrSfftKbs4_ULZb2tQ_asJ4H2M2pvZE8QeiAQAgcEgsGg8DBEEAMIhsOh8QAEKiMGicUi8YjMHIEagcBLjQ-M6g6c8d3XSHKQ6vmDiiBruj09Mbo5BohqdzN6M28kJRnG_4AKALjdqFmbZwHQdklZTIqzsnk-KIyZZ5-VWLzzRPnHagFriI-IagZOz2xVJuSLUZRAqpdWST2u5hZFz1SPv9dubz3JJVSDKgVzmiZeXDGf1XbdQXmqPpzmmJYJUj0-QGYK7vw1Gu-yb4AKCeVtH_iHjIWDcJklf8bXCjdbDjGkjIZHgecUkS9utsRKAZqQLgk_adghzCR5hBo9-P4axble7p3ZitT4gfnGgB8rkE-vkE9wDiAaBMzCbYg_3ZjL6N4TGoWlW7WHu2goEttMalL1FYbv71X_kE0PhLhwXfH2d8J1u4QaIeQf4n5d5QM5ASewbJCKE6uEVhCp2AX6jl_Sc2UpdUTqmT2882GnFlkxfLk1jUjRJ3f5Pbv9SdMSlOphVksqQB-EuHBd8fZ3worrhBOkyHV6CWNbIQzaXJF9HfdEiTnm9f4CIoQ2l2Ok-zBPsac9OJh66hBEz_38bq3x4_gIieNYuRd9uxIx_Q5oP1wAD4S4cF3x9nfCqDuEFpJIzNRkFaLJaPDTDW3iBO7U9ctbFk81Eg1kC6nrqYSnBOJfYMg_zZM7GwV64QKXWoEW14zW-OjBD8xIwj9N1KAfhLhwXfH2d7ZGG4QQwvV6_S0mqz9t3reZBLGmZMdqPcEKw_4rd7nmkn1pjiTtjroN7WDsglYmXUnDmNDx_SiFfUffvTYf2UrK5WRYEA-EuHBd8fZ3thkrhBNHzBJ29Zm_SKlpr_wiAG7QnSMOLlIZBAVxMzG40IWvZusO1kF-CkXO6cFPrGeqkkuQBpORIewTXKnL3QQFDxAwH4S4cF3x9nfDBOuEHSgCeHKh9Z4Ctnh-DVMTXq6ezpOz0NHpbmKXOMnEh6RQfMgcKjUAHpm503r-Wunb16GCJnzE0o9UkDicjhw_snAfhLhwXfH2d7YD24QSUFpPl06j9jlGVdjxgRMZVxGL7p2Nknki2nkN-qtwV2CaEYxbajoBPu00N9T-D1V9QhgosjXHTVJSZdAbWB0_UB-EuHBd8fZ3wqDrhBIxjF3WWQPk28WffeSySqWbE2bH3QNgRKYyyO4PeDmXpB6DcwvtPAcjs7KXrzi1KMm8VmXqXRg6iYKX3ADpxZAwH4S4cF3x9nfCRRuEEDHxmsldikFMx3mAeyd-q4QWf47CfGE90sq8W3Dbj9_lTS-CQ8QFZq85qFhzywRZMl5C6EkkugB91DRtFPXHDFAfhLhwXfH2d8Lga4QW0Wavm4ozugSb-EX5kfgckex_AbR2Ya8-TYGamGD3R_ciVSZLMV6XOxOYaxVRQd4o0gZmQX_kDCMNUMiP1aH2UB-EuHBd8fZ3tk2LhBROmaxIClOyJemx_-djdrOeMY0A9m4SbYCBEqeDF4cAVnZgsGbtbK5LsQmHoJc9EA1L2w-MjIozGWRBuoNuuSqAD4S4cF3x9ne2LuuEFW-0IVrVsW9xhpXIFPOROLV60mRuxR6QMVDE8jj-ks3wdw2BtGtpMKoHx_6HQAQuMCC96lAKErPr6sl7Fcj8GcAfhLhwXfH2d7bIa4QYLSJZx5tnbXf76X9EIiNHnfL4s4NpnOvr52RZBLXyl-XYgBmeYQW0KGyhvIfirAF70ToJ6v_QJhmLd4b9xVkA8A-EuHBd8fZ3tkFrhBKGgu-7qWylRDEexkc380bot1BceybEFfxQZGGc3r_CF2F1OnAhAapG8ocSiU1WswBYrmlgBMILnXt3bdMU6UnwD4S4cF3x9nfCmbuEEqLvVPQxjxHuQJZrmtLQF4pwoK_bY3py9TkSDfA3-oQBul2cduvvuV4hNfOJ3ROWPj7AlJJzy5V8vsnbjbzLsrAfhLhwXfH2d7Yue4QaynqP2gORAEEet7SE0M0nkkOlSfoE6aw_jNI0XMyLQ1EVzdr_UpqQ7znibsI2fbYtXbC-I3HjqXR4qbgUPYfl8B-AC5Bqb5BqO5AaH5AZ4Cg3E6U4cF3x9nfCkklQBvNsCzwKLuG9M6iI-Ett7cefcFKqDaCOQ6UJnoVgeRNTzkHR_zgD8NX_obCbO0WG2bxJTEvKDmA_esjItGk5r6nQp2EuayCpLufTb1n0uY1SxLTHBo1aBvyC2weI5hP5qDiR65Eh9kcRCZnbATb2vKh13lYZGIg_gAoHsRne4NCgDq-uxr-mgbzeK0Cg9JiyD05f03qtUFv2FYogEAIHBILBoPAwRBADCIbDofEABCojBonFIvGIzByBGoHAS40PjOoOnPHd10hykOr5g4oga7o9PTG6OQaIanczejNvJCUZxv-ACgfl8zcoJzjcGHIigl19jbvSoCPCatsogKC5nf5CLKq4m4iPiGoBVfS-gbEZF6NY12uES57m-DJq06MxYjWnE-LEZtnqTQoFc5omXlwxn9V23UF5qj6c5piWCVI9PkBmCu78NRrvsm-ACgnlbR_4h4yFg3CZJX_G1wo3Ww4xpIyGR4HnFJEvbrbESgGakC4JP2nYIcwkeYQaPfj-GsW5Xu6d2YrU-IH5xoAfK5BPr5BPcA4gGgHmaJetyyFcqp8gCYx6ICV89cYtk-ZreRHmvG1oqtYEP5BND4S4cF3x9nmyinuEH8M2oc4l2YtgPWWIds7Q3ttxWw2txyF6TBRR0v5PLAWyKj18RFMB2U6Y4JgWWem5HcumZzIPwqNR3YBVagJ7pnAfhLhwXfH2ebKIu4QdPCIoyP7F-aBbzGRCzPARCI8iLXJqcbaRdv4klmB_jnbwyp-SPe_RtWd9A3JFSWQKcQjeJfL_l_Y3LQJD8WIQoB-EuHBd8fZ5srC7hB2cC1XV3VwsbscBwoutpByykgyGt0iKePlvcYeOyYqHtFEs6kZSkoeAG_PvyhfVwnAbKiQPX7SFru2hK58zR8qQH4S4cF3x9nmkVfuEGHT1Gk63Raa6pJNAHCZ53FBv88XpEwf4q3wUt_cORq3DV0iM8ADgmUDFzcm9F8518DGdHqXiyqy5DY0FKjDv41AfhLhwXfH2eaRFW4QXnWuUodPzFQrk8LqmskIfkWUxExSQVtIdKgfOYZGxxbYxb7Yq7d5TTkRtGve1-bHeyf9-nvolqxkrhz4VGq4asB-EuHBd8fZ5syjbhBcIY2kjfj-PpVdbGmdb00rJ3vICtzR-mXwZsuljEmqIMYsEoZZu2gsQV74pOCjaLcysYWlSOtY3yGGs34fF37iwD4S4cF3x9nmkZ7uEH6z4U9vX72o5bojTD9_L-vbd69A3bgKzB1FpOPAb0lngRIARIZAyUvOahqKXHA4EsITCQCLKgbVwE7Wfdb7Aj0AfhLhwXfH2ebKx-4QRec54zkmXq42Nnf-knTFZ2SjCKawK1D4-FYKx8X8maCY-bCdr-2fDMiztdpbdUCQZXJ6uBx8tEfmbcMEYX-ox4B-EuHBd8fZ5smu7hBSPqYyPa8go5sIEmBbNkIlIoLqZq1oc62kRqiW0PyYNcN-pGPCSjwIcMdtu2f_SlQ5T0imuQQQYk9ObXHPRtgYgD4S4cF3x9nmyf0uEGNfsqIW99B7wuwtpBtNeTkP47SapccK2bewlvmmfH3LgrCmaqI50ZwSXhSELAA2c5V6h5cakUWPW8c2lksETASAPhLhwXfH2eaP6m4Qc_tW_-cl2EwwWwfNb-_mrVWZraRyn-DJYFnRDC57yY-CH1pjJ2V3L_H0lPuAHcpvlVMwrjH09PDOKB7JRUFO_kB-EuHBd8fZ5pDmbhBsOQO9fL5AkOPKhvV0jXqx0VejugKkqpIKpLFpBsLOv0T41ZiZHWkubua3DFAXFApaeYkr0oRcAJltjrlg2JixAH4S4cF3x9nmkGmuEGga_Cd81GT33f2hjdKIBJi4J9MFC7tBzDL-oLvM2AKCEwy8V4tzOfrmTCi85t3RVI4p1nB8TncABoBTq5SgLZiAfhLhwXfH2ebAZa4QaewJOp7ZHi6-UnSTN6R6zonZkkBc5PQDxf9jMSlisZDFdVyhEaNeJ0a3YMvOLxWsTQt_N9nwrKt6TWJkjNPMiMB-EuHBd8fZ5srv7hBHrCywfpBcMl_32FClh4u1bLbf2MQvqzzvEgijCPvDRku-5U8ZKmSHSlBCYpO9ycCczcy3IxvtNcoGwVCrROumQD4S4cF3x9nmki-uEECCYDjz6wPHDSjl7c9MJYccJ7CE8y03l-c7v358fVTpA_3u2K4-OwA07PZ8LBT5HIKnt098fo105IQXtBHH-VPAPgA-ADA".to_string()).unwrap();

    testing_env!(context(alice(), 999_999_999_999_999_999_9));

    let response = contract.handle_relay_message(
        BTPAddress::new(format!(
            "btp://0x1.near/7448a64f98a7f2ca3e4e292dd18984ef4466e0e7739fbc7add59f7a580630c6d"
        )),
        BTPAddress::new(
            "btp://0x2.icon/cxda4e4a3829860f12470125c66f259ed7b3f62206".to_string(),
        ),
        0,
        relay_message,
    );
}
